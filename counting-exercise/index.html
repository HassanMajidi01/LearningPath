<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تمرین‌های شمارش</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Tahoma', 'Helvetica Neue', Arial, sans-serif;
            /* جلوگیری از اسکرول افقی ناخواسته */
            overflow-x: hidden;
        }
        /* Header */
header {
  background-color: #1d2d50;
  color: #fff;
  padding: 20px 0;
  border-bottom: 3px solid #fcbf49;
}

header h1 {
  text-align: center;
  margin-bottom: 10px;
  font-size: 2.5rem;
}

/* منو */
nav ul {
  list-style: none;
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
}

nav ul li {
  margin: 0 15px;
}

nav ul li a {
  color: #fff;
  text-decoration: none;
  padding: 10px 20px;
  transition: background-color 0.3s ease, transform 0.3s ease;
  border-radius: 5px;
  font-size: 1rem;
}

nav ul li a:hover {
  background-color: #fcbf49;
  transform: translateY(-3px);
}
        .exercise-container, .exercise-container-2, .exercise-container-3 {
            max-width: 600px;
            margin: 20px auto; /* کاهش مارجین عمودی برای موبایل */
            padding: 15px; /* کاهش پدینگ برای موبایل */
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            background-color: #f9fafb;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        @media (min-width: 640px) { /* sm breakpoint */
            .exercise-container, .exercise-container-2, .exercise-container-3 {
                margin: 30px auto;
                padding: 20px;
            }
        }

        .item-number-pair-container {
            display: flex;
            flex-direction: column; 
            align-items: center;
            margin: 3px; /* کاهش مارجین برای جا شدن بهتر */
        }
        .item-image {
            font-size: 1.8rem; /* کمی کوچکتر برای موبایل */
            width: 35px; /* کمی کوچکتر برای موبایل */
            height: 35px; /* کمی کوچکتر برای موبایل */
            display: inline-flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
            background-color: #f0f0f0;
            border-radius: 4px;
            margin-bottom: 3px;
            margin-left: 2px; 
            margin-right: 2px;
        }
         @media (min-width: 640px) { /* sm breakpoint */
            .item-image {
                font-size: 2rem;
                width: 40px;
                height: 40px;
                margin-bottom: 4px;
                margin-left: 3px;
                margin-right: 3px;
            }
        }

        .number-box { 
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 35px; 
            height: 35px; 
            font-size: 1rem; 
            border: 1px solid transparent; 
            border-radius: 4px;
            box-sizing: border-box;
            text-align: center;
        }
         @media (min-width: 640px) { /* sm breakpoint */
            .number-box {
                width: 40px;
                height: 40px;
                font-size: 1.1rem;
            }
        }
        .number-box-input { 
            width: 35px;
            height: 35px;
            text-align: center;
            border: 1px solid #cbd5e1;
            border-radius: 4px;
            font-size: 1rem;
            box-sizing: border-box;
        }
        @media (min-width: 640px) { /* sm breakpoint */
            .number-box-input {
                width: 40px;
                height: 40px;
                font-size: 1.1rem;
            }
        }


        .choice-label {
            display: flex;
            align-items: center;
            padding: 8px; /* کاهش پدینگ */
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            margin-bottom: 6px; /* کاهش مارجین */
            cursor: pointer;
            background-color: white;
            transition: background-color 0.2s;
            font-size: 0.9rem; /* کاهش فونت گزینه ها */
        }
        @media (min-width: 640px) { /* sm breakpoint */
            .choice-label {
                padding: 10px;
                margin-bottom: 8px;
                font-size: 1rem;
            }
        }
        .choice-label input[type="radio"] {
            margin-left: 8px; /* کاهش مارجین */
        }
         @media (min-width: 640px) { /* sm breakpoint */
            .choice-label input[type="radio"] {
                margin-left: 10px;
            }
        }

        .choice-text-number-sequence {
            direction: ltr;
            unicode-bidi: bidi-override;
        }
        .button-container {
            margin-top: 15px; /* کاهش مارجین */
            display: flex;
            flex-direction: column; /* دکمه ها زیر هم در موبایل */
            gap: 8px; 
        }
        @media (min-width: 640px) { /* sm breakpoint */
            .button-container {
                flex-direction: row; /* دکمه ها کنار هم در صفحات بزرگتر */
                justify-content: space-between;
                gap: 10px; 
            }
        }
        .button {
            padding: 10px 12px; 
            border-radius: 6px;
            font-size: 0.9rem; 
            cursor: pointer;
            transition: background-color 0.2s;
            border: none;
            width: 100%; /* دکمه ها تمام عرض در موبایل */
            text-align: center;
        }
         @media (min-width: 640px) { /* sm breakpoint */
            .button {
                padding: 10px 15px;
                font-size: 0.95rem;
                flex-grow: 1; /* فقط در صفحات بزرگتر فضای مساوی بگیرند */
                width: auto; /* بازگشت به عرض خودکار */
            }
        }

        .check-button { background-color: #3b82f6; color: white; }
        .check-button:hover { background-color: #2563eb; }
        .next-button { background-color: #10b981; color: white; }
        .next-button:hover { background-color: #059669; }
        .skip-button { background-color: #6b7280; color: white; }
        .skip-button:hover { background-color: #4b5563; }
        .button:disabled { background-color: #9ca3af; cursor: not-allowed; }
        .related-video { background-color: #3b82f6; color: white; margin-top: 8px; }
        .related-video:hover { background-color: #e0e7ff; }
        
        .feedback {
            margin-top: 8px;
            padding: 6px;
            font-size: 0.85rem; /* کاهش فونت بازخورد */
            border-radius: 4px;
            text-align: center;
        }
         @media (min-width: 640px) { /* sm breakpoint */
            .feedback {
                margin-top: 10px;
                padding: 8px;
                font-size: 1rem;
            }
        }
        .feedback.correct { background-color: #d1fae5; color: #065f46; }
        .feedback.incorrect { background-color: #fee2e2; color: #991b1b; }

        .progress-bar-container {
            width: 100%;
            background-color: #e5e7eb;
            border-radius: 4px;
            margin-bottom: 10px; /* کاهش مارجین */
            overflow: hidden;
        }
        .progress-bar {
            height: 8px; /* کاهش ارتفاع */
            background-color: #3b82f6;
            width: 0%;
            transition: width 0.3s ease-in-out;
        }
         @media (min-width: 640px) { /* sm breakpoint */
             .progress-bar {
                height: 10px;
            }
            .progress-bar-container {
                margin-bottom: 15px;
            }
        }

        .items-display-area-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: flex-start; 
            min-height: 80px; /* کاهش ارتفاع حداقلی */
            margin-bottom: 10px;
            direction: ltr; 
        }
         @media (min-width: 640px) { /* sm breakpoint */
            .items-display-area-container {
                min-height: 100px;
                margin-bottom: 15px;
            }
        }


        /* استایل های تمرین نوع دوم (قرار دادن در جعبه) */
        .put-in-box-source-item-container {
            margin-bottom: 10px;
            display: flex;
            justify-content: center;
        }
        .put-in-box-source-item { 
            font-size: 2.2rem; /* کمی کوچکتر */
            width: 50px; /* کمی کوچکتر */
            height: 50px; /* کمی کوچکتر */
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background-color: #e5e7eb;
            border: 2px dashed #9ca3af;
            border-radius: 8px;
            cursor: grab; 
            transition: background-color 0.2s;
        }
         @media (min-width: 640px) { /* sm breakpoint */
            .put-in-box-source-item {
                font-size: 2.5rem;
                width: 60px;
                height: 60px;
            }
             .put-in-box-source-item-container {
                margin-bottom: 15px;
            }
        }
        .put-in-box-source-item:active { cursor: grabbing; }

        .put-in-box-target-box { 
            width: 100%;
            min-height: 120px; /* کاهش ارتفاع */
            background-color: #f3f4f6;
            border: 2px dashed #9ca3af; 
            border-radius: 8px;
            padding: 8px; /* کاهش پدینگ */
            display: flex;
            flex-wrap: wrap;
            align-content: flex-start;
            gap: 6px; /* کاهش فاصله */
        }
         @media (min-width: 640px) { /* sm breakpoint */
            .put-in-box-target-box {
                min-height: 150px;
                padding: 10px;
                gap: 8px;
            }
        }
        .put-in-box-target-box.drag-over { background-color: #e0e7ff; border-color: #6366f1; }

        .put-in-box-placed-item { 
            font-size: 1.8rem; /* کمی کوچکتر */
            width: 40px; 
            height: 40px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background-color: #d1d5db; 
            border: 1px solid #9ca3af;
            border-radius: 4px;
            cursor: pointer; 
            user-select: none; 
        }
        @media (min-width: 640px) { /* sm breakpoint */
            .put-in-box-placed-item {
                font-size: 2rem;
                width: 45px;
                height: 45px;
            }
        }

        .section-title { 
            font-size: 1.25rem; /* کاهش فونت عنوان بخش */
            font-weight: bold;
            color: #1f2937;
            text-align: center;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #e5e7eb;
        }
        @media (min-width: 640px) { /* sm breakpoint */
            .section-title {
                font-size: 1.5rem;
                margin-bottom: 20px;
                padding-bottom: 10px;
            }
        }
        
        /* عنوان اصلی سوالات در هر بخش */
        .exercise-question-title {
            font-size: 1.1rem; /* کاهش فونت عنوان سوال */
            font-weight: 600; /* semibold */
            margin-bottom: 10px; /* کاهش مارجین */
            color: #1f2937; /* Tailwind gray-800 */
        }
        @media (min-width: 640px) { /* sm breakpoint */
            .exercise-question-title {
                font-size: 1.25rem; /* Tailwind text-xl */
                 margin-bottom: 1rem; /* mb-4 */
            }
        }


        /* استایل های جدید برای تمرین نوع سوم (مسائل داستانی) */
        .story-problem-image-container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }
         @media (min-width: 640px) { /* sm breakpoint */
            .story-problem-image-container {
                margin-bottom: 15px;
            }
        }
        .story-problem-text { 
            font-size: 1rem; /* کاهش فونت */
            color: #374151;
            margin-bottom: 6px;
            line-height: 1.5;
        }
         @media (min-width: 640px) { /* sm breakpoint */
            .story-problem-text {
                font-size: 1.1rem;
                margin-bottom: 8px;
                line-height: 1.6;
            }
        }
        .story-problem-question { 
            font-size: 1.1rem; /* کاهش فونت */
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 10px;
        }
         @media (min-width: 640px) { /* sm breakpoint */
            .story-problem-question {
                font-size: 1.2rem;
                margin-bottom: 15px;
            }
        }
        .story-problem-fill-blank { 
            display: inline-block;
            width: 40px; /* کمی کوچکتر */
            height: 25px; /* کمی کوچکتر */
            border-bottom: 2px solid #9ca3af;
            margin: 0 4px;
            vertical-align: bottom; 
        }
        @media (min-width: 640px) { /* sm breakpoint */
            .story-problem-fill-blank {
                width: 50px;
                height: 30px;
                margin: 0 5px;
            }
        }

        .related-videos-section {
            margin: 30px auto 0;
            max-width: 260px;
        }
        .related-video-item {
            width: 100%;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            padding: 6px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .video-embed {
            width: 100%;
            aspect-ratio: 16/9;
            min-height: 120px;
        }
        .related-video-title {
            font-size: 0.9rem;
            margin-top: 4px;
            text-align: center;
        }

    </style>
</head>
<body class="bg-gray-100">
    <header>
    <div class="container">
      <h1>تمرین شمارش</h1>
      <nav>
        <ul>
          <li><a href="../index.html">صفحه اصلی</a></li>
          <li><a href="../math.html">ریاضیات</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <div id="exercise-container-2" class="exercise-container-2">
    <h2 class="section-title">شمارش با اعداد کوچک</h2>
    <div id="pib-progress-text" class="text-sm text-gray-600 mb-2 text-center"></div>
    <div class="progress-bar-container">
        <div id="pib-progress-bar" class="progress-bar"></div>
    </div>
    <h3 id="pib-question-text" class="exercise-question-title text-center"></h3>
    <div id="pib-source-item-area" class="put-in-box-source-item-container"></div>
    <div id="pib-target-box-area" class="put-in-box-target-box" 
         ondragover="event.preventDefault()" 
         ondrop="handleDrop(event)"></div>
    <div id="pib-feedback-message" class="feedback" style="display: none;"></div>
    <div class="button-container">
        <button id="pib-check-button" class="button check-button">بررسی</button>
        <button id="pib-skip-button" class="button skip-button">رد شدن</button>
        <button id="pib-next-button" class="button next-button" disabled>بعدی</button>
    </div>

</div>
 <!-- بخش ویدئوهای مرتبط -->
<div class="related-videos-section">
    <h2 class="section-title">ویدئوهای مرتبط</h2>
    <div class="related-video-item">
        <div id="41357763279" class="video-embed">
            <script type="text/JavaScript" src="https://www.aparat.com/embed/maejlhi?data[rnddiv]=41357763279&data[responsive]=yes"></script>
        </div>
        <div class="related-video-title">شمارش با اعداد کوچک</div>
    </div>
</div>
<!-- پایان بخش ویدئوهای مرتبط -->


    <div id="exercise-container" class="exercise-container">
        <h2 class="section-title">به ترتیب بشمارید</h2>
        <div id="progress-text" class="text-sm text-gray-600 mb-2 text-center"></div>
        <div class="progress-bar-container">
            <div id="progress-bar" class="progress-bar"></div>
        </div>
        <h3 id="question-text" class="exercise-question-title text-center"></h3>
        <div id="main-content-area" class="items-display-area-container"></div>
        <div id="feedback-message" class="feedback" style="display: none;"></div>
        <div class="button-container">
            <button id="check-button" class="button check-button">بررسی</button>
            <button id="next-button" class="button next-button" disabled>بعدی</button>
        </div>
        
    </div>

   
    <div id="exercise-container-3" class="exercise-container-3">
        <h2 class="section-title">یک عدد بیشتر یا یک عدد کمتر را پیدا کن</h2>
        <div id="sp-progress-text" class="text-sm text-gray-600 mb-2 text-center"></div>
        <div class="progress-bar-container">
            <div id="sp-progress-bar" class="progress-bar"></div>
        </div>
        
        <div id="sp-story-text-area" class="text-center">
            </div>
        <div id="sp-question-area" class="text-center mt-3">
            </div>
        <div id="sp-choices-area" class="mt-4">
            </div>

        <div id="sp-feedback-message" class="feedback" style="display: none;"></div>
        <div class="button-container">
            <button id="sp-check-button" class="button check-button">بررسی</button>
            <button id="sp-skip-button" class="button skip-button">رد شدن</button>
            <button id="sp-next-button" class="button next-button" disabled>بعدی</button>
        </div>
    </div>


    
</div>


    <script>
        // --- SCRIPT برای تمرین نوع اول ---
        const exercises1 = [
            { id: 1, type: 'fill-in-the-blanks', questionTextFarsi: "کفشدوزک‌ها را بشمارید. اعداد جا افتاده را در کادرها وارد کنید.", items: { icon: '🐞' }, sequence: [1, 2, null, null], correctAnswers: [3, 4] },
            { id: 2, type: 'multiple-choice', questionTextFarsi: "چگونه بلوط‌ها را می‌شماریم؟", items: { icon: '🌰', count: 2 }, choices: [{ text: "۱، ۳", isCorrect: false },{ text: "۱، ۲", isCorrect: true }], correctAnswerText: "۱، ۲" },
            { id: 3, type: 'fill-in-the-blanks', questionTextFarsi: "نهنگ‌ها را بشمارید. اعداد جا افتاده را در کادرها وارد کنید.", items: { icon: '🐳' }, sequence: [1, null, 3, 4, null], correctAnswers: [2, 5]},
            { id: 4, type: 'multiple-choice', questionTextFarsi: "چگونه موزها را می‌شماریم؟", items: { icon: '🍌', count: 9 }, choices: [{ text: "۱ ۲ ۳ ۴ ۵ ۶ ۷ ۸ ۹", isCorrect: true },{ text: "۱ ۲ ۳ ۵ ۴ ۶ ۸ ۹ ۷", isCorrect: false }], correctAnswerText: "۱ ۲ ۳ ۴ ۵ ۶ ۷ ۸ ۹" },
            { id: 5, type: 'fill-in-the-blanks', questionTextFarsi: "اسب‌های کوچک را بشمارید. اعداد جا افتاده را در کادرها وارد کنید.", items: { icon: '🐎' }, sequence: [1, 2, 3, null, 5, null, 7], correctAnswers: [4, 6]},
            { id: 6, type: 'multiple-choice', questionTextFarsi: "چگونه کفشدوزک‌ها را می‌شماریم؟", items: { icon: '🐞', count: 4 }, choices: [{ text: "۲ ۳ ۴ ۵", isCorrect: false },{ text: "۱ ۲ ۳ ۴", isCorrect: true }], correctAnswerText: "۱ ۲ ۳ ۴" },
            { id: 7, type: 'fill-in-the-blanks', questionTextFarsi: "گل‌ها را بشمارید. اعداد جا افتاده را در کادرها وارد کنید.", items: { icon: '🌸' }, sequence: [null, 2, 3, null, 5], correctAnswers: [1, 4]}
        ];
        // ... (بقیه کد تمرین نوع اول بدون تغییر باقی می ماند) ...
        let currentExercise1Index = 0;
        let correctAnswers1Count = 0;
        const questionText1El = document.getElementById('question-text');
        const mainContentArea1El = document.getElementById('main-content-area');
        const feedbackMessage1El = document.getElementById('feedback-message');
        const checkButton1El = document.getElementById('check-button');
        const nextButton1El = document.getElementById('next-button');
        const progressBar1El = document.getElementById('progress-bar');
        const progressText1El = document.getElementById('progress-text');

        function loadExercise1(index) {
            if (index >= exercises1.length) { showCompletionScreen1(); return; }
            const exercise = exercises1[index];
            questionText1El.textContent = exercise.questionTextFarsi; // این عنوان اصلی سوال است
            mainContentArea1El.innerHTML = ''; 
            feedbackMessage1El.style.display = 'none';
            nextButton1El.disabled = true; checkButton1El.disabled = false;

            if (exercise.type === 'fill-in-the-blanks') {
                exercise.sequence.forEach((seqItem, i) => {
                    const pairContainer = document.createElement('div'); pairContainer.className = 'item-number-pair-container';
                    if (exercise.items && exercise.items.icon) {
                        const itemSpan = document.createElement('span'); itemSpan.className = 'item-image'; itemSpan.textContent = exercise.items.icon;
                        pairContainer.appendChild(itemSpan);
                    }
                    if (seqItem === null) {
                        const input = document.createElement('input'); input.type = 'number';
                        input.className = 'number-box-input input-field'; input.setAttribute('data-input-index', i.toString()); 
                        pairContainer.appendChild(input);
                    } else {
                        const span = document.createElement('span'); span.className = 'number-box'; 
                        span.textContent = seqItem; pairContainer.appendChild(span);
                    }
                    mainContentArea1El.appendChild(pairContainer);
                });
            } else if (exercise.type === 'multiple-choice') {
                // برای سوالات چندگزینه ای، عنوان اصلی سوال (questionTextFarsi) در h3 است
                // تصاویر مربوط به گزینه ها (اگر باشند) در اینجا نمایش داده می شوند
                if (exercise.items && exercise.items.icon && exercise.items.count) {
                     const itemImageContainer = document.createElement('div');
                    itemImageContainer.className = 'flex flex-wrap justify-center mb-3 w-full';
                    if (document.documentElement.dir === 'rtl') { itemImageContainer.style.direction = 'rtl'; }
                    for (let i = 0; i < exercise.items.count; i++) {
                        const itemSpan = document.createElement('span'); itemSpan.className = 'item-image'; 
                        itemSpan.textContent = exercise.items.icon; itemImageContainer.appendChild(itemSpan);
                    }
                    mainContentArea1El.appendChild(itemImageContainer); // تصاویر آیتم های سوال چند گزینه ای
                }
               
                const choicesContainer = document.createElement('div'); choicesContainer.className = 'w-full'; 
                exercise.choices.forEach((choice) => {
                    const label = document.createElement('label'); label.className = 'choice-label';
                    const radio = document.createElement('input'); radio.type = 'radio'; radio.name = 'choice';
                    radio.value = choice.text; radio.className = 'ml-2';
                    const textSpan = document.createElement('span');
                    textSpan.innerHTML = `<span class="choice-text-number-sequence">${choice.text}</span>`; 
                    label.appendChild(radio); label.appendChild(textSpan);
                    choicesContainer.appendChild(label);
                });
                mainContentArea1El.appendChild(choicesContainer); // گزینه ها
            }
            updateProgress1();
        }
        function checkAnswer1() {
            const exercise = exercises1[currentExercise1Index]; let isCorrect = false;
            if (exercise.type === 'fill-in-the-blanks') {
                const inputs = mainContentArea1El.querySelectorAll('input.input-field'); let userAnswers = [];
                inputs.forEach(input => { userAnswers.push(input.value !== '' ? parseInt(input.value) : NaN); });
                isCorrect = userAnswers.length === exercise.correctAnswers.length && userAnswers.every((val, idx) => val === exercise.correctAnswers[idx]);
            } else if (exercise.type === 'multiple-choice') {
                const selectedRadio = mainContentArea1El.querySelector('input[name="choice"]:checked');
                if (selectedRadio) { isCorrect = selectedRadio.value === exercise.correctAnswerText; }
            }
            feedbackMessage1El.style.display = 'block';
            if (isCorrect) {
                feedbackMessage1El.textContent = "عالی! پاسخ شما صحیح است."; feedbackMessage1El.className = 'feedback correct';
                nextButton1El.disabled = false; checkButton1El.disabled = true; 
                if (!exercise.answeredCorrectly) { correctAnswers1Count++; exercise.answeredCorrectly = true; }
            } else {
                feedbackMessage1El.textContent = "دوباره تلاش کنید."; feedbackMessage1El.className = 'feedback incorrect';
            }
            updateProgress1(); 
        }
        function nextExercise1() { currentExercise1Index++; loadExercise1(currentExercise1Index); }
        function updateProgress1() {
            const percentage = exercises1.length > 0 ? (currentExercise1Index / exercises1.length) * 100 : 0;
            progressBar1El.style.width = percentage + '%';
            progressText1El.textContent = currentExercise1Index < exercises1.length ? `تمرین ${currentExercise1Index + 1} از ${exercises1.length}` : `تکمیل شد!`;
        }
        function showCompletionScreen1() {
            questionText1El.textContent = "تبریک! شما بخش اول تمرین‌ها را کامل کردید.";
            mainContentArea1El.innerHTML = `<div class="text-center w-full"><span class="text-5xl">🎉</span><p class="text-lg mt-2">شما به ${correctAnswers1Count} از ${exercises1.length} تمرین پاسخ صحیح دادید.</p></div>`;
            feedbackMessage1El.style.display = 'none'; checkButton1El.style.display = 'none';
            nextButton1El.textContent = "شروع مجدد"; nextButton1El.disabled = false;
            nextButton1El.onclick = () => {
                currentExercise1Index = 0; correctAnswers1Count = 0;
                exercises1.forEach(ex => ex.answeredCorrectly = false); 
                checkButton1El.style.display = 'inline-block'; nextButton1El.textContent = "بعدی";
                nextButton1El.onclick = nextExercise1; 
                if (exercises1.length > 0) loadExercise1(currentExercise1Index);
            };
            updateProgress1(); 
        }
        if (checkButton1El) checkButton1El.addEventListener('click', checkAnswer1);
        if (nextButton1El) nextButton1El.addEventListener('click', nextExercise1);
        if (exercises1.length > 0) loadExercise1(currentExercise1Index);


        // --- SCRIPT برای تمرین نوع دوم ---
        const exercises2 = [
            { id: 1, questionTextFarsi: "۹ اسب در جعبه قرار دهید.", itemIcon: '🐎', correctCount: 9, itemNameFarsi: "اسب" },
            { id: 2, questionTextFarsi: "۴ سنجاب در جعبه قرار دهید.", itemIcon: '🐿️', correctCount: 4, itemNameFarsi: "سنجاب" },
            { id: 3, questionTextFarsi: "۳ کوسه در جعبه قرار دهید.", itemIcon: '🦈', correctCount: 3, itemNameFarsi: "کوسه" },
            { id: 4, questionTextFarsi: "۷ بلوط در جعبه قرار دهید.", itemIcon: '🌰', correctCount: 7, itemNameFarsi: "بلوط" },
            { id: 5, questionTextFarsi: "۴ روباه در جعبه قرار دهید.", itemIcon: '🦊', correctCount: 4, itemNameFarsi: "روباه" },
            { id: 6, questionTextFarsi: "۵ سیب در جعبه قرار دهید.", itemIcon: '🍎', correctCount: 5, itemNameFarsi: "سیب" },
            { id: 7, questionTextFarsi: "۷ سنجاب دیگر در جعبه قرار دهید.", itemIcon: '🐿️', correctCount: 7, itemNameFarsi: "سنجاب" },
        ];
        // ... (بقیه کد تمرین نوع دوم بدون تغییر باقی می ماند) ...
        let currentExercise2Index = 0;
        let correctAnswers2Count = 0;
        const pibQuestionTextEl = document.getElementById('pib-question-text');
        const pibSourceItemAreaEl = document.getElementById('pib-source-item-area');
        const pibTargetBoxAreaEl = document.getElementById('pib-target-box-area');
        const pibFeedbackMessageEl = document.getElementById('pib-feedback-message');
        const pibCheckButtonEl = document.getElementById('pib-check-button');
        const pibSkipButtonEl = document.getElementById('pib-skip-button');
        const pibNextButtonEl = document.getElementById('pib-next-button');
        const pibProgressBarEl = document.getElementById('pib-progress-bar');
        const pibProgressTextEl = document.getElementById('pib-progress-text');

        function handleDragStart(event) {
            event.dataTransfer.setData("text/plain", event.target.textContent);
            event.target.style.opacity = '0.5';
        }
        function handleDragEnd(event) {
            event.target.style.opacity = '1';
        }
        function handleDrop(event) {
            event.preventDefault(); 
            const itemIcon = event.dataTransfer.getData("text/plain");
            if (itemIcon) { 
                const placedItem = document.createElement('div');
                placedItem.className = 'put-in-box-placed-item';
                placedItem.textContent = itemIcon;
                placedItem.onclick = () => { placedItem.remove(); };
                pibTargetBoxAreaEl.appendChild(placedItem);
            }
            if (pibTargetBoxAreaEl) pibTargetBoxAreaEl.classList.remove('drag-over');
        }
        if (pibTargetBoxAreaEl) {
            pibTargetBoxAreaEl.addEventListener('dragenter', (event) => {
                event.preventDefault();
                pibTargetBoxAreaEl.classList.add('drag-over');
            });
            pibTargetBoxAreaEl.addEventListener('dragleave', (event) => {
                if (!pibTargetBoxAreaEl.contains(event.relatedTarget)) {
                    pibTargetBoxAreaEl.classList.remove('drag-over');
                }
            });
        }
        function loadExercise2(index) {
            if (index >= exercises2.length) { showCompletionScreen2(); return; }
            const exercise = exercises2[index];
            if(pibQuestionTextEl) pibQuestionTextEl.textContent = exercise.questionTextFarsi;
            
            if(pibSourceItemAreaEl) pibSourceItemAreaEl.innerHTML = ''; 
            const sourceItem = document.createElement('div');
            sourceItem.className = 'put-in-box-source-item';
            sourceItem.textContent = exercise.itemIcon;
            sourceItem.draggable = true; 
            sourceItem.addEventListener('dragstart', handleDragStart);
            sourceItem.addEventListener('dragend', handleDragEnd);
            sourceItem.title = `این ${exercise.itemNameFarsi} را به داخل جعبه بکشید`;
            if(pibSourceItemAreaEl) pibSourceItemAreaEl.appendChild(sourceItem);

            if(pibTargetBoxAreaEl) pibTargetBoxAreaEl.innerHTML = '';

            if(pibFeedbackMessageEl) pibFeedbackMessageEl.style.display = 'none';
            if(pibNextButtonEl) pibNextButtonEl.disabled = true;
            if(pibCheckButtonEl) pibCheckButtonEl.disabled = false;
            if(pibSkipButtonEl) pibSkipButtonEl.disabled = false;
            updateProgress2();
        }
        function checkAnswer2() {
            const exercise = exercises2[currentExercise2Index];
            const currentPlacedItemsCount = pibTargetBoxAreaEl ? pibTargetBoxAreaEl.children.length : 0;
            const isCorrect = currentPlacedItemsCount === exercise.correctCount;

            if(pibFeedbackMessageEl) pibFeedbackMessageEl.style.display = 'block';
            if (isCorrect) {
                if(pibFeedbackMessageEl) {pibFeedbackMessageEl.textContent = "عالی! پاسخ شما صحیح است."; pibFeedbackMessageEl.className = 'feedback correct';}
                if(pibNextButtonEl) pibNextButtonEl.disabled = false;
                if(pibCheckButtonEl) pibCheckButtonEl.disabled = true;
                if(pibSkipButtonEl) pibSkipButtonEl.disabled = true;
                if (!exercise.answeredCorrectly) {
                    correctAnswers2Count++;
                    exercise.answeredCorrectly = true;
                }
            } else {
                 if(pibFeedbackMessageEl) {
                    pibFeedbackMessageEl.textContent = `تعداد ${exercise.itemNameFarsi}‌ها صحیح نیست. شما ${currentPlacedItemsCount} عدد قرار داده‌اید، باید ${exercise.correctCount} عدد باشد. برای اصلاح، روی آیتم‌های اضافی در جعبه کلیک کنید تا حذف شوند.`;
                    pibFeedbackMessageEl.className = 'feedback incorrect';
                 }
            }
            updateProgress2();
        }
        function skipExercise2() { currentExercise2Index++; loadExercise2(currentExercise2Index); }
        function nextExercise2() { currentExercise2Index++; loadExercise2(currentExercise2Index); }
        function updateProgress2() {
            const percentage = exercises2.length > 0 ? (currentExercise2Index / exercises2.length) * 100 : 0;
            if(pibProgressBarEl) pibProgressBarEl.style.width = percentage + '%';
            if(pibProgressTextEl) pibProgressTextEl.textContent = currentExercise2Index < exercises2.length ? `تمرین ${currentExercise2Index + 1} از ${exercises2.length}` : `تکمیل شد!`;
        }
        function showCompletionScreen2() {
            if(pibQuestionTextEl) pibQuestionTextEl.textContent = "تبریک! شما بخش دوم تمرین‌ها را کامل کردید.";
            if(pibSourceItemAreaEl) pibSourceItemAreaEl.innerHTML = '';
            if(pibTargetBoxAreaEl) pibTargetBoxAreaEl.innerHTML = `<div class="text-center w-full"><span class="text-5xl">🎉</span><p class="text-lg mt-2">شما به ${correctAnswers2Count} از ${exercises2.length} تمرین پاسخ صحیح دادید.</p></div>`;
            if(pibFeedbackMessageEl) pibFeedbackMessageEl.style.display = 'none';
            if(pibCheckButtonEl) pibCheckButtonEl.style.display = 'none'; 
            if(pibSkipButtonEl) pibSkipButtonEl.style.display = 'none';
            if(pibNextButtonEl) {
                pibNextButtonEl.textContent = "شروع مجدد"; pibNextButtonEl.disabled = false;
                pibNextButtonEl.onclick = () => {
                    currentExercise2Index = 0; correctAnswers2Count = 0;
                    exercises2.forEach(ex => ex.answeredCorrectly = false);
                    if(pibCheckButtonEl) pibCheckButtonEl.style.display = 'inline-block'; 
                    if(pibSkipButtonEl) pibSkipButtonEl.style.display = 'inline-block';
                    pibNextButtonEl.textContent = "بعدی";
                    pibNextButtonEl.onclick = nextExercise2;
                    if (exercises2.length > 0) loadExercise2(currentExercise2Index);
                };
            }
            updateProgress2();
        }
        if (pibCheckButtonEl) pibCheckButtonEl.addEventListener('click', checkAnswer2);
        if (pibSkipButtonEl) pibSkipButtonEl.addEventListener('click', skipExercise2);
        if (pibNextButtonEl) pibNextButtonEl.addEventListener('click', nextExercise2);
        if (exercises2.length > 0) loadExercise2(currentExercise2Index);


        // --- SCRIPT برای تمرین نوع سوم (مسائل داستانی) ---
        const exercises3 = [
            { 
                id: 1, 
                story: [
                    { type: 'text', content: "آرمیتا گل‌های زیر را چید." },
                    { type: 'image', icon: '🌸', count: 3 },
                    { type: 'text', content: "او ۱ گل دیگر چید." }
                ],
                question: "حالا او <span class='story-problem-fill-blank'></span> گل دارد.", 
                choices: [
                    { text: "7", isCorrect: false },
                    { text: "4", isCorrect: true },
                    { text: "14", isCorrect: false }
                ],
                correctAnswerValue: "4" // مقدار عددی برای مقایسه
            },
            { 
                id: 2, 
                story: [
                    { type: 'text', content: "آرشام ۲ هات‌داگ درست کرد." },
                    { type: 'image', icon: '🌭', count: 2, initial: true }, // تصویر اولیه
                    { type: 'text', content: "او ۱ هات‌داگ دیگر درست کرد." }
                ],
                question: "آرشام چند هات‌داگ درست کرد؟", 
                choices: [ // گزینه ها شامل تصویر هستند
                    { text: "", icons: ['🌭','🌭','🌭'], isCorrect: true, choiceValue: "3" }, // 3 hotdogs
                    { text: "", icons: ['🌭'], isCorrect: false, choiceValue: "1" },           // 1 hotdog
                    { text: "", icons: ['🌭','🌭','🌭','🌭','🌭'], isCorrect: false, choiceValue: "5" } // 5 hotdogs
                ],
                correctAnswerValue: "3"
            },
            { 
                id: 3, 
                story: [
                    { type: 'text', content: "ارمیا ۱۷ سنجاب دید." },
                    { type: 'image', icon: '🐿️', count: 17 },
                    { type: 'text', content: "یک سنجاب فرار کرد." }
                ],
                question: "چند سنجاب باقی مانده است؟", 
                choices: [
                    { text: "16", isCorrect: true },
                    { text: "7", isCorrect: false },
                    { text: "14", isCorrect: false }
                ],
                correctAnswerValue: "16"
            },
             { 
                id: 4, 
                story: [
                    { type: 'text', content: "بارانا ۱۶ بلوط دید." },
                    // { type: 'image', icon: '🌰', count: 16 }, // تصویر برای این تمرین در فایل نبود
                    { type: 'text', content: "یک بلوط غلتید و رفت." }
                ],
                question: "چند بلوط باقی مانده است؟", 
                choices: [
                    { text: "15", isCorrect: true },
                    { text: "19", isCorrect: false },
                    { text: "12", isCorrect: false }
                ],
                correctAnswerValue: "15"
            },
            { 
                id: 5, 
                story: [
                    { type: 'text', content: "باغ وحش میمون‌های زیر را داشت." },
                    { type: 'image', icon: '🐒', count: 7 },
                    { type: 'text', content: "باغ وحش ۱ میمون دیگر گرفت." }
                ],
                question: "حالا <span class='story-problem-fill-blank'></span> میمون در باغ وحش وجود دارد.", 
                choices: [
                    { text: "8", isCorrect: true },
                    { text: "15", isCorrect: false },
                    { text: "2", isCorrect: false }
                ],
                correctAnswerValue: "8"
            },
             { 
                id: 6, 
                story: [
                    { type: 'text', content: "سگ گله ۱۱ استخوان داشت." },
                    { type: 'image', icon: '🦴', count: 11, initial: true },
                    { type: 'text', content: "او یکی را خورد." }
                ],
                question: "چند استخوان باقی مانده است؟", 
                choices: [ 
                    { text: "", icons: Array(10).fill('🦴'), isCorrect: true, choiceValue: "10" }, // 10 bones
                    { text: "", icons: Array(12).fill('🦴'), isCorrect: false, choiceValue: "12" },// 12 bones
                    { text: "", icons: Array(11).fill('🦴'), isCorrect: false, choiceValue: "11" } // 11 bones
                ],
                correctAnswerValue: "10"
            },
            { 
                id: 7, 
                story: [
                    { type: 'text', content: "اهورا ۱۱ کوسه دید." },
                    { type: 'image', icon: '🦈', count: 11 },
                    { type: 'text', content: "سپس او ۱ کوسه دیگر دید." }
                ],
                question: "اهورا <span class='story-problem-fill-blank'></span> کوسه دید.", 
                choices: [
                    { text: "13", isCorrect: false },
                    { text: "7", isCorrect: false },
                    { text: "12", isCorrect: true }
                ],
                correctAnswerValue: "12"
            }
        ];

        let currentExercise3Index = 0;
        let correctAnswers3Count = 0;

        const spStoryTextAreaEl = document.getElementById('sp-story-text-area');
        const spQuestionAreaEl = document.getElementById('sp-question-area');
        const spChoicesAreaEl = document.getElementById('sp-choices-area');
        const spFeedbackMessageEl = document.getElementById('sp-feedback-message');
        const spCheckButtonEl = document.getElementById('sp-check-button');
        const spSkipButtonEl = document.getElementById('sp-skip-button');
        const spNextButtonEl = document.getElementById('sp-next-button');
        const spProgressBarEl = document.getElementById('sp-progress-bar');
        const spProgressTextEl = document.getElementById('sp-progress-text');

        function loadExercise3(index) {
            if (index >= exercises3.length) {
                showCompletionScreen3();
                return;
            }
            const exercise = exercises3[index];

            spStoryTextAreaEl.innerHTML = '';
            exercise.story.forEach(part => {
                if (part.type === 'text') {
                    const p = document.createElement('p');
                    p.className = 'story-problem-text';
                    p.innerHTML = part.content; 
                    spStoryTextAreaEl.appendChild(p);
                } else if (part.type === 'image') {
                    const imgContainer = document.createElement('div');
                    imgContainer.className = 'story-problem-image-container';
                    for (let i = 0; i < part.count; i++) {
                        const itemSpan = document.createElement('span');
                        itemSpan.className = 'item-image'; 
                        itemSpan.textContent = part.icon;
                        imgContainer.appendChild(itemSpan);
                    }
                    spStoryTextAreaEl.appendChild(imgContainer);
                }
            });

            spQuestionAreaEl.innerHTML = `<p class="story-problem-question">${exercise.question}</p>`;
            
            spChoicesAreaEl.innerHTML = '';
            exercise.choices.forEach(choice => {
                const label = document.createElement('label');
                label.className = 'choice-label';
                
                const radio = document.createElement('input');
                radio.type = 'radio';
                radio.name = 'sp-choice';
                radio.value = choice.choiceValue !== undefined ? choice.choiceValue : choice.text; 

                const textSpan = document.createElement('span');
                if (choice.icons && choice.icons.length > 0) { 
                    choice.icons.forEach(icon => {
                        const iconSpan = document.createElement('span');
                        iconSpan.className = 'item-image'; 
                        iconSpan.style.margin = '0 2px'; 
                        iconSpan.textContent = icon;
                        textSpan.appendChild(iconSpan);
                    });
                } else {
                    textSpan.innerHTML = `<span class="choice-text-number-sequence">${choice.text}</span>`;
                }
                
                label.appendChild(radio);
                label.appendChild(textSpan);
                spChoicesAreaEl.appendChild(label);
            });

            spFeedbackMessageEl.style.display = 'none';
            spNextButtonEl.disabled = true;
            spCheckButtonEl.disabled = false;
            spSkipButtonEl.disabled = false;
            updateProgress3();
        }

        function checkAnswer3() {
            const exercise = exercises3[currentExercise3Index];
            const selectedRadio = document.querySelector('input[name="sp-choice"]:checked');
            let isCorrect = false;

            if (selectedRadio) {
                isCorrect = selectedRadio.value === exercise.correctAnswerValue;
            }

            spFeedbackMessageEl.style.display = 'block';
            if (isCorrect) {
                spFeedbackMessageEl.textContent = "عالی! پاسخ شما صحیح است.";
                spFeedbackMessageEl.className = 'feedback correct';
                spNextButtonEl.disabled = false;
                spCheckButtonEl.disabled = true;
                spSkipButtonEl.disabled = true;
                if (!exercise.answeredCorrectly) {
                    correctAnswers3Count++;
                    exercise.answeredCorrectly = true;
                }
            } else {
                spFeedbackMessageEl.textContent = "دوباره تلاش کنید. پاسخ شما نادرست است.";
                spFeedbackMessageEl.className = 'feedback incorrect';
            }
            updateProgress3();
        }

        function skipExercise3() {
            currentExercise3Index++;
            loadExercise3(currentExercise3Index);
        }
        function nextExercise3() {
            currentExercise3Index++;
            loadExercise3(currentExercise3Index);
        }

        function updateProgress3() {
            const percentage = exercises3.length > 0 ? (currentExercise3Index / exercises3.length) * 100 : 0;
            spProgressBarEl.style.width = percentage + '%';
            spProgressTextEl.textContent = currentExercise3Index < exercises3.length ? `تمرین ${currentExercise3Index + 1} از ${exercises3.length}` : `تکمیل شد!`;
        }

        function showCompletionScreen3() {
            spStoryTextAreaEl.innerHTML = '';
            spQuestionAreaEl.innerHTML = `<div class="text-center w-full"><p class="text-xl font-semibold">تبریک! شما بخش سوم تمرین‌ها را کامل کردید.</p><span class="text-5xl mt-2 inline-block">🎉</span><p class="text-lg mt-2">شما به ${correctAnswers3Count} از ${exercises3.length} تمرین پاسخ صحیح دادید.</p></div>`;
            spChoicesAreaEl.innerHTML = '';
            spFeedbackMessageEl.style.display = 'none';
            spCheckButtonEl.style.display = 'none';
            spSkipButtonEl.style.display = 'none';
            spNextButtonEl.textContent = "شروع مجدد";
            spNextButtonEl.disabled = false;
            spNextButtonEl.onclick = () => {
                currentExercise3Index = 0;
                correctAnswers3Count = 0;
                exercises3.forEach(ex => ex.answeredCorrectly = false);
                spCheckButtonEl.style.display = 'inline-block';
                spSkipButtonEl.style.display = 'inline-block';
                spNextButtonEl.textContent = "بعدی";
                spNextButtonEl.onclick = nextExercise3;
                if (exercises3.length > 0) loadExercise3(currentExercise3Index);
            };
            updateProgress3();
        }

        if(spCheckButtonEl) spCheckButtonEl.addEventListener('click', checkAnswer3);
        if(spSkipButtonEl) spSkipButtonEl.addEventListener('click', skipExercise3);
        if(spNextButtonEl) spNextButtonEl.addEventListener('click', nextExercise3);
        if (exercises3.length > 0) loadExercise3(currentExercise3Index);


    </script>

    
</div>



</body>
</html>
